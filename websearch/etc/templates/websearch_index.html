{#
## This file is part of Invenio.
## Copyright (C) 2012 CERN.
##
## Invenio is free software; you can redistribute it and/or
## modify it under the terms of the GNU General Public License as
## published by the Free Software Foundation; either version 2 of the
## License, or (at your option) any later version.
##
## Invenio is distributed in the hope that it will be useful, but
## WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
## General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with Invenio; if not, write to the Free Software Foundation, Inc.,
## 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
#}
{% from "_formhelpers.html" import render_filter_form with context %}
{% from "websearch_helpers.html" import collection_tree, portalbox_sidebar, search_also, search_form, search_form_javascript with context %}
{% extends "page.html" %}
{# set title = collection.name_ln if collection.id > 1 else None #}
{% set title = None %}

{%- set portalboxes = dict() -%}
{%- for k,l in collection.portalboxes_ln|groupby('position') -%}
  {%- do portalboxes.update({k:l}) -%}
{%- endfor -%}

{% block header %}
  {{ super() }}
  {% js "js/websearch_typeahead.js" %}
  {% js "js/bootstrap-select.js" %}
{% endblock %}

{% block title %}
  {{ portalboxes.tp }}
  {{ super() }}
  {{ portalboxes.te }}
{% endblock %}


{% macro collection_records(collection) %}

<div class="row websearch narrow-by clearfix search-wrap">
 
  {{ portalbox_sidebar(portalboxes.lt, class="span2") }}

  {% if collection.collection_children_r %}
      <h3 class="span9 offset3">{{ _("Narrow by collections") }}:</h3>
      <div class="span9 offset3">
      {{ collection_tree(collection.collection_children_r, limit=2, class="clearfix browse") }}
      </div>
  {% else %}
      <div class="span{{ '4' if collection.collection_children_v else '8' }}">
      {% if collection.is_restricted %}
        <strong>{{ _('This collection is restricted. If you are authorized to access it, please click on the Search button.') }}</strong>
      {% else %}
        {% if collection.latest_additions %}
        {% for recid in collection.latest_additions[-10:]|reverse %}
          <div class="row-fluid span1 offset1">
            <div class="span12">
               {{ format_record(recid, 'hb', ln=g.ln)|safe }}
             </div>
          </div>
        {% endfor %}
        {% if collection.reclist|length > 10 %}
          <a href="{{ url_for('search.search', cc=collection.name, jrec=11)|safe }}"
             class="pull-right muted">[&gt;&gt; {{ _('more')}}]</a>
        {% endif %}
        {% endif %}
      {% endif %}
      </div>
  {% endif %}

  {% if collection.collection_children_v %}
      <h3 class="span9 offset3">{{ _("Focus on") }}:</h3>
      <div class="span9 offset3">
      {{ collection_tree(collection.collection_children_v, limit=2, class="clearfix browse") }}
      {{ search_also(collection.externalcollections_2) }}
      </div>
  {% elif collection.externalcollections_2 %}
      <div class="span2">
        {{ search_also(collection.externalcollections_2) }}
      </div>
  {% endif %}

  {% if portalboxes.lt %}
    {{ portalbox_sidebar(portalboxes.rt, class="span2") }}
  {% else %}
    {{ portalbox_sidebar(portalboxes.rt, class="offset2 span2") }}
  {% endif %}

</div> <!-- /row -->
</div> <!-- /search-index -->
</div> <!-- /container -->

{% endmacro %}

{% block body %}

<div class="search-index">
<header class="jumbotron masthead centered">
    <h1>Atlantis Blogs</h1>
    <p>Preserving and disseminating blogs using <br> the BlogForever Platform</p>
</header>

<div class="row hero centered">
  {{ search_form(collection) }}
</div>

{% if collection.is_restricted %}
  {{ collection_records(collection) }}
{% else %}
  {% cache 24*60*60, collection.name, g.ln %}
    {{ collection_records(collection) }}
  {% endcache %}
{% endif %}


<div class="green-bg">
<div class="container">
<div class="marketing">
  <h1>More Blogforever repositories:</h1>
  <p class="marketing-byline">See what other institutions are doing with Blogforever blog repositories</p>
  <ul class="thumbnails example-sites">
    <li class="span3">
      <a href="http://bf1.csd.auth.gr/" class="thumbnail">
        <img src="/img/bf1-screenshot.jpg" alt="BF1 case study repository">
        <h4>Case study repository BF1</h4>
        <p>Explore 1,342 records</p>
      </a>
    </li>
    <li class="span3">
      <a href="http://bf3.itc.auth.gr/" class="thumbnail">
        <img src="/img/bf3-screenshot.jpg" alt="Sample archive">
        <h4>Case study repository BF2</h4>
        <p>Explore 9,467 records</p>
      </a>
    </li>
    <li class="span3">
      <a href="#" class="thumbnail">
        <img src="/img/bf3-screenshot.jpg" alt="Sample archive">
        <h4> Repository Three</h4>
        <p>Adipisicing elit, sed Thurs.</p>
      </a>
    </li>
    <li class="span3">
     <a href="#" class="thumbnail">
        <img src="/img/bf3-screenshot.jpg" alt="Sample archive">
        <h4> Repository Four</h4>
        <p>Lorem ipsum dolor sit amet</p>
      </a>
    </li>
  </ul>

    <hr class="soften">

    <h1>Why is blog preservation important?</h1>
  <p class="marketing-byline">Preserving Atlantis's blogosphere for future generations.</p>
  <div class="row">
    <div class="span4">
      <h2><i class="icon icon-folder-open"></i> Archiving</h2>
      <p>Sed ut unde omnis iste perspiciatis natus error sit voluptatem accusantium doloremque laudantium, Totam aperiam rem, eaque ipsa quae $
    </div>
    <div class="span4">

      <h2><i class="icon icon-briefcase"></i> Preservation</h2>
      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed Thurs eiusmod tempor incididunt ut labore et dolore magna Aliqua. Ut en$
    </div>
    <div class="span4">
      <h2><i class="icon icon-bullhorn"></i> Dissemination</h2>
      <p>At vero eos et accusamus iusto odio et qui dignissimos ducimus blanditiis praesentium voluptatum deleniti atque corrupti quos dolores$
    </div>
  </div><!--/row-->

<p class="pull-right"><a href="#">Back to top</a></p>

</div><!-- /marketing -->
</div><!-- /container -->
</div>

{% endblock %}

{% block javascript %}
<script>
(function($) {
  $('[rel=tooltip]').tooltip();
})(jQuery);
</script>
{{ search_form_javascript(collection)}}
{% endblock %}